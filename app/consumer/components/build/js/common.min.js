"use strict";function ConsumerBaseQuery(){this.$loading=$(".loading"),this.$dialog=$(".dialog"),this.$promptBox=$(".prompt-box"),this.$dialogContent=$(".dialog-content"),this.$qrcodeanimation=$(".qrcodeanimation")}function interAjax(t,e){$.post(t,e,function(t){t.status?ConsumerBaseQuery.showPrompt(t.info.msg,"icon-right"):ConsumerBaseQuery.showPrompt(t.info.msg,"icon-colse"),$btnPointsEntityAffirm.html("确认提交").attr("disabled",!1),$btnPromptReload.on("click",function(){window.location.href=reload_url})})}function checkAdressForm(){$.each($("form :input"),function(){var t=$(this).attr("data-name");if("isEmpty"===t){if(""===$(this).val()){var e=$(this).parent().find("span").text().replace(":","");return ConsumerBaseQuery.entityError(e+"填写不正确"),!1}}else if("isSelectEmpty"===t){if(0===$(this).prop("selectedIndex"))return ConsumerBaseQuery.entityError("请填写正确的地址信息"),!1}else if("isTelphone"===t){if(!$(this).val().match(/^1[3|4|5|7|8]\d{9}$/))return ConsumerBaseQuery.entityError("手机号填写不正确"),!1}else $entityError.html("")})}function cityChange(t,e){return 0!==$(t).val()&&void $.post(city_url,"city=1&id="+$(t).val(),function(t){var i="";for(var n in t.info.data)i+='<option value="'+t.info.data[n].id+'">'+t.info.data[n].name+"</option>";switch($("#county").hide().find("select").html('<option value="0">请选择区县</option>'),e){case 0:$("#city").html('<option value="0">请选择市区</option>'),$("#city").append(i);break;case 1:""!==i&&$("#county").show().find("select").append(i)}})}var ajaxData,speed=2e3,activate="createTouch"in document?"touchend":"click",storage=window.localStorage,$inpTelphone=$(".inp-telphone"),$btnDraw=$(".btn-draw"),$hideDialog=$(".dialog-fade"),$pointsTips=$(".points-header"),$pointsTipsClose=$(".points-header span"),$btnPrizeAddress=$('.btn-prize[data-name="btn-address"]'),$btnPrizeAddressBack=$(".btn-back"),$btnPrompt=$('.btn-prompt[data-name="prize-prompt"]'),$btnPromptReload=$('.btn-prompt[data-name="points-prompt"]'),$btnPrizeVirtual=$('.btn-prize[data-name="btn-virtual"]'),$entityError=$(".entity-error"),$btnPrizeAffirm=$('.btn-affirm[data-name="btn-prize-affirm"]'),$btnPointsAffirm=$('input[data-name="btn-points-affirm"]'),$btnPointsEntityAffirm=$('.btn-affirm[data-name="btn-points-entity-affirm"]');"undefined"!==storage.telephone&&$(".inp-telphone").val(storage.telephone),ConsumerBaseQuery.prototype={showLoading:function(){this.$loading.css("display","block")},hideLoading:function(){this.$loading.css("display","none")},showDialog:function(t){this.$dialog.addClass("dialog-active"),this.$dialogContent.addClass("element-active").find("span").html(t)},hideDialog:function(){this.$dialog.removeClass("dialog-active"),this.$promptBox.removeClass("element-active"),this.$dialogContent.removeClass("element-active")},showQrcodeAnimation:function(){this.$dialog.addClass("dialog-active"),this.$qrcodeanimation.addClass("qrcode-active")},hideQrcodeAnimation:function(){var t=this;this.$dialog.click(function(){$(this).removeClass("dialog-active"),t.$qrcodeanimation.removeClass("qrcode-active")})},entityError:function(t){$entityError.html(t).css("display","block")},showPrompt:function(t,e){this.$dialog.addClass("dialog-active"),this.$promptBox.addClass("element-active"),this.$promptBox.find(".prompt-box-cot span").removeClass().addClass(e),this.$promptBox.find(".prompt-box-cot p").html(t)},selectToggle:function(t){$(t.obj).on("click",function(){$(this).toggleClass("active").siblings().removeClass("active"),$(t.obj).hasClass("active")?t.btnEle.removeClass("btn-gray").addClass("btn-affirm").attr("disabled",!1):t.btnEle.removeClass("btn-affirm").addClass("btn-gray").attr("disabled",!0)})}};var ConsumerBaseQuery=new ConsumerBaseQuery;$(function(){$hideDialog.on(activate,function(){ConsumerBaseQuery.hideDialog()}),$btnPrompt.on(activate,function(){ConsumerBaseQuery.hideDialog()}),setTimeout(function(){$pointsTips.fadeIn(1200)},300),$pointsTipsClose.on(activate,function(){setTimeout(function(){$pointsTips.fadeOut(1200)},300)}),$btnDraw.on(activate,function(){return ajaxData=isWritePhone?"phone="+$inpTelphone.val():"phone=",$inpTelphone.length>0&&!$inpTelphone.val().match(/^1[3|4|5|7|8]\d{9}$/)?(ConsumerBaseQuery.showDialog("请输入正确的手机号码"),!1):(ConsumerBaseQuery.showLoading(),void setTimeout(function(){$.post(drawUrl,ajaxData,function(t){return t.info.code<0?(window.location.href=errorURL+"/error.html?error="+t.info.code,!1):(window.location.href=prizeUrl+"&city[shenid]=0&city[shiid]=0&city[quid]=0&address=&phone=",void(storage.telephone=$inpTelphone.val()))})},speed))}),$btnPrizeAddress.on(activate,function(){$(".md-address").addClass("md-address-visible")}),$btnPrizeAddressBack.on(activate,function(){$(".md-address").removeClass("md-address-visible"),$btnPointsAffirm.attr("disabled",!1).val("立即兑换")}),$btnPrizeAffirm.on(activate,function(){checkAdressForm(),""===$entityError.html()&&($(this).html("正在提交中...").attr("disabled"),window.location.href=addressURL+"&"+$("form").serialize())}),ConsumerBaseQuery.selectToggle({obj:$(".intergral-item li"),btnEle:$btnPointsAffirm}),$btnPointsAffirm.on("click",function(){var t,e=$(".intergral-item li.active"),i=e.attr("data-id"),n=e.attr("data-stytem"),o=url_before+i+url_after;$(this).val("正在提交中...").attr("disabled",!0),"1"===n?($(".md-address").addClass("md-address-visible"),$btnPointsEntityAffirm.on(activate,function(){checkAdressForm(),""===$entityError.html()&&(t=$("form").serialize(),$(this).html("正在提交中...").attr("disabled"),interAjax(o,t))})):(t="",interAjax(o,t))}),$btnPrizeVirtual.on(activate,function(){var t=$(".prizePromptTxt"),e=$(".prizePromptEntity"),i=t.html();"focus"==prizeStatus.action?(ConsumerBaseQuery.showQrcodeAnimation(),ConsumerBaseQuery.hideQrcodeAnimation()):"oneself"==prizeStatus.action?(t.css("display","none"),e.css("display","block"),ConsumerBaseQuery.showPrompt()):ConsumerBaseQuery.showPrompt(i,"icon-right")})});
//# sourceMappingURL=common.min.js.map
